/* A. Do the OP.* tables actually exist? */
proc sql;
  select memname from dictionary.tables
  where libname='OP'
  order by memname;
quit;

/* B. Can you write to the folder? (creates then deletes a tiny file) */
filename _w "M:\Data\GRM_SB\Steering Committee\Collection file\_write_test.txt";
data _null_; file _w; put 'ok'; run;
data _null_; rc=fdelete('_w'); run;
filename _w clear;



/* ====== Month token & output file ====== */
%let mth   = 202508;   /* change to 202509 etc. for a new file */
%let xfile = M:\Data\GRM_SB\Steering Committee\Collection file\sb_steerco_inventory_&mth..xlsx;

/* ====== List the datasets you expect to export ====== */
%let _export_list =
  Summarized_DB
  Summary_DB
  Cust_Summary_DB
  Vintage_6MOB
  Vintage_12MOB
  Num_Customers
  IG_source
  MN_Portfolio
;

/* ====== Export via a single ODS EXCEL session (skip missing tables) ====== */
ods _all_ close;
ods excel file="&xfile"
   options(sheet_interval="none" embedded_titles='yes' frozen_headers='yes');

%macro _sheet(dsn);
  %if %sysfunc(exist(op.&dsn)) %then %do;
    ods excel options(sheet_name="&dsn");
    title "&dsn";
    proc print data=op.&dsn noobs; run;
    title;
  %end;
  %else %do;
    %put WARNING: op.&dsn does not exist. Skipping this sheet.;
  %end;
%mend;

%macro export_all(list=&_export_list);
  %local i n name;
  %let n=%sysfunc(countw(&list,%str( )));
  %do i=1 %to &n;
    %let name=%scan(&list,&i,%str( ));
    %_sheet(&name);
  %end;
%mend;

%export_all();

ods excel close;
